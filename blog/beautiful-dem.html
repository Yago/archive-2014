<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Beautiful DEM | Yann Gouffon</title>
    <meta name="description" content="Après avoir écrit un article sur la cartographie web, j'ai voulu pousser plus loin la création de cartes. Du coup, je me suis mis à TileMill et les portes du vaste monde du SIG open source se sont ouvertes devant moi. La cartographie web reste un domaine très technique et&hellip;">
    <meta name="keywords" content="yann, gouffon, Yago, Antistatique, frontend, develloper, Swiss, Suisse, designer, eikon, fribourg, lausanne, 3D, web, internet, site, graphic">
    <meta name="viewport" content="width=device-width">

    <meta property="og:title" content="Beautiful DEM">
    <meta property="og:type" content="website">
    <meta property="og:url" content="/blog/beautiful-dem">
            <meta property="og:image" content="/content/cover/beautiful-dem.jpg">
            <meta property="og:site_name" content="Yann Gouffon">
    <meta property="og:description" content="Après avoir écrit un article sur la cartographie web, j'ai voulu pousser plus loin la création de cartes. Du coup, je me suis mis à TileMill et les portes du vaste monde du SIG open source se sont ouvertes devant moi. La cartographie web reste un domaine très technique et&hellip;">

    <link rel="stylesheet" href="../themes/yago/build/css/vendors.css">
    <link rel="stylesheet" href="../themes/yago/build/css/yago.css">

    <script type="text/javascript" src="http://use.typekit.net/oyy3kts.js"></script>
    <script type="text/javascript">try{Typekit.load();}catch(e){}</script>

    <!--[if lt IE 9]>
      <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
        <div id="sb-site">
              <header class="covered-header">
          <nav class="navbar navbar-default" role="navigation">
            <div class="container">
              <div class="navbar-header">
                <button type="button" id="open-menu" class="navbar-toggle" aria-hidden="true">
                  <span class="sr-only">Toggle navigation</span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="../index.html">
                  <img class="yago-dark" src="../themes/yago/build/img/yago-dark.svg" onerror="this.onerror=null; this.src='/themes/yago/build/img/yago-dark.png'" alt="alt" />
                  <img class="yago-light" src="../themes/yago/build/img/yago-light.svg" onerror="this.onerror=null; this.src='/themes/yago/build/img/yago-light.png'" alt="alt" />
                </a>
              </div>

              <div class="main-nav navbar-right hidden-xs" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                  <li><a href="../index.html" title="Home">Home</a></li>
                  <li><a href="../projects.html" title="Projects">Projects</a></li>
                  <li class="active"><a href="../blog.html" title="Blog">Blog</a></li>
                </ul>
              </div>
            </div>
          </nav>
                                  <div class="img-focus"
                data-focus-x="0"
                data-focus-y="0"
                data-image-w="2880"
                data-image-h="1296">
                                                      <img src="/content/cover/beautiful-dem.jpg" alt="" />
                                                </div>
                    <div class="inset-shadow" aria-hidden="true"></div>
        </header>
            
            <div class="container">
  <article>
    <div class="row">
      <div class="col-sm-8 col-sm-offset-2">
        <h1>Beautiful DEM</h1>
        <div class="tags">
          <small><em>24th Jun 2013</em></small>
          <span class="text-silver">&nbsp;&nbsp;|&nbsp;&nbsp;</span>
          <small><em>
            <span class="fa fa-tags"></span>
                                        <a href="../tag/gis.html">gis</a>
                      </em></small>
        </div>
        <hr>
        <p>
            <p>Après avoir écrit un <a href="http://antistatique.net/blog/2013/04/05/devenez-un-maitre-cartographe/">article</a> sur la cartographie web, j'ai voulu pousser plus loin la création de cartes. Du coup, je me suis mis à <a href="http://www.mapbox.com/tilemill/">TileMill</a> et les portes du vaste monde du SIG open source se sont ouvertes devant moi. La cartographie web reste un domaine très technique et relativement peu accessible, mais une fois les premières clefs obtenues, le reste vient de soi.</p>
<p>Après avoir vu une petite <a href="http://www.mapbox.com/blog/tilemill-raster-colorizer/">démonstration</a> d'un développeur de chez MapBox, j'ai cherché à reproduire l'exemple sans utiliser la version de développement de TileMill et en appliquant l'expérimentation à notre belle Suisse.</p>
<h2>Trouver les données</h2>
<p>Le plus compliqué dans cet exercice a été de trouver des données DEM (digital elevation model) open source et avec une résolution suffisante à un niveau de zoom correct. Il se trouve que les USA sont très en avance en la matière, mais l'Europe... Bref, j'ai fini par trouver <a href="http://www.viewfinderpanoramas.org/dem3.html">un site</a> très bien qui en partage un certain nombre avec des qualités variant de 1'' à 15''.</p>
<h2>Traiter les données</h2>
<p>Ce que vous allez télécharger en fichier .dem ou .hgt sont des données brutes qu'il faudra transformer en images utilisables dans TileMill ou Mapnik. Pour cela, il existe une librairie libre permettant de traiter les images géographiques : <a href="http://www.gdal.org/index.html">Gdal</a>. Pour les utilisateurs de Mac, rendez-vous sur <a href="http://www.kyngchaos.com/software:frameworks">kyngchaos.com</a> pour obtenir un framework prêt à l'emploi de la librairie et de ses dépendances.</p>
<p>Après avoir installé la librairie, veillez à ne pas oublier de configurer le chemin dans le fichier de configuration de votre terminal :</p>
<pre><code class="language-shell">export PATH=/Library/Frameworks/GDAL.framework/Programs:$PATH</code></pre>
<p>Une fois installé, il va vous falloir merger tous vos fichiers afin de garder un seul fichier DEM. Pour cela, exécutez gdal-merge en spécifiant le nom du fichier combiné, suivi de tous les fichiers que vous souhaitez fusionner.</p>
<pre><code class="language-shell">$ gdal_merge.py -init "255" -o combined.dem file01.dem file02.dem file03.dem</code></pre>
<h2>Obtenir des GeoTIFF</h2>
<p>Gdal, entre autres choses, permet de créer des GeoTIFF utilisables dans TileMill ou Mapnik à partir d'un fichier DEM. Pour cet exemple nous aurons besoin de 3 images différentes.</p>
<h3>Hillshade</h3>
<p>L'image Hillshade permet d'appréhender au mieux un relief. Grâce à ce modèle numérique de terrain répondant aux conventions d'illumination, l'appréhension du relief de votre carte sera optimal. Pour cela :</p>
<pre><code class="language-shell">$ gdaldem hillshade -s 111120 combined.dem hillshade.tif</code></pre>
<p><img alt="gdal hillshade" src="/content/images/alps-hillshade.jpg" /></p>
<h3>Color-relief</h3>
<p>Le color-relief vous permettra d'ajouter des couleurs à votre carte, déterminées par l'altitude. Pour cela, commencez par créer un fichier <strong>color.txt</strong> dans lequel vous donnerez des couleurs rgb en fonction de l'altitude (ici 0m, 500m, 1000m, 2500m et 4000m).</p>
<pre><code class="language-plain">0 71 68 62
500 119 101 74 
1000 85 107 50 
2500 187 187 120 
4000 217 222 170 </code></pre>
<p>Et dans le terminal :</p>
<pre><code class="language-shell">$ gdaldem color-relief combined.dem color.txt color.tif</code></pre>
<p><img alt="gdal color-relief" src="/content/images/alps-color.jpg" /></p>
<h3>Slope</h3>
<p>Le slope est une image qui va mettre en valeur le relief d'une façon différente de l'image hillshade, mais qui va apporter une grosse plus value à votre carte finale. Comme pour color-relief, créez un fichier <strong>color_slope.txt</strong>, indiquant cette fois la coloration en fonction de la pente (entre 0 et 90°).</p>
<pre><code class="language-shell">0 255 255 255
90 0 0 0</code></pre>
<p>Et dans votre console :</p>
<pre><code class="language-shell">$ gdaldem slope combined.dem preslope.tif -s 111120
$ gdaldem color-relief preslope.tif color_slope.txt slope.tif</code></pre>
<p><img alt="gdal slope" src="/content/images/alps-slope.jpg" /></p>
<h2>Finalisation</h2>
<p>Ouvrez TileMill et ajoutez vos 3 nouveaux calques en choisissant le bon système de projection (probablement WGS84). Encore un petit peu de CartoCSS et votre carte sera prête ! Dans l'ordre d'empilement :</p>
<pre><code class="language-css">.slope {
  raster-opacity:0.4;
  raster-scaling:lanczos;
  raster-comp-op: grain-extract;
}
.hillshade {
  raster-opacity:1;
  raster-scaling:lanczos;
  raster-comp-op: soft-light;
}
.color {
  raster-opacity:1;
  raster-scaling:lanczos;
}</code></pre>
<p><strong>Le résultat</strong> : <a href="http://geolab.io/swissdem.html">geolab.io/swissdem.html</a></p>
<h2>Conclusion</h2>
<p>À partir de cette petite démo, on saisit rapidement l'étendue des possibilités offertes, pouvant ainsi créer toutes sortes de fonds pour nos cartes web. Vous voici entré dans la cour des grands !</p>
        </p>
                  <hr>
          <div id="disqus_thread"></div>
          <script type="text/javascript">
              /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
              var disqus_shortname = 'yago-io'; // required: replace example with your forum shortname

              /* * * DON'T EDIT BELOW THIS LINE * * */
              (function() {
                  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
              })();
          </script>
          <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
              </div>
    </div>
  </article>
</div>  
              <footer>
          <div class="container">
            <div class="row">
              <div class="col-sm-12 text-center">
                <hr>                <div class="spacer spacer-xs"></div>
                <h2 class="h4">Let's keep in touch</h2>
                <div class="spacer spacer-sm"></div>
                <a href="https://twitter.com/Yago_0" class="fa-stack fa-lg">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                </a>
                <a href="https://github.com/Yago/" class="fa-stack fa-lg">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                </a>
                <a href="http://ch.linkedin.com/pub/yann-gouffon/47/9a0/9bb/" class="fa-stack fa-lg">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                </a>
                <a href="http://instagram.com/yago_0" class="fa-stack fa-lg">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-instagram fa-stack-1x fa-inverse"></i>
                </a>
                <a href="https://plus.google.com/+YannGouffon/" class="fa-stack fa-lg">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-google-plus fa-stack-1x fa-inverse"></i>
                </a>
                <a href="mailto:hello@yago.io" class="fa-stack fa-lg">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                </a>
                <div class="spacer spacer-xl"></div>
              </div>
            </div>
          </div>
        </footer>
      
    </div>

    <div class="sb-slidebar sb-right" aria-hidden="true">
      <ul class="nav navbar-nav">
        <li><a href="../index.html" title="Home">Home</a></li>
        <li><a href="../projects.html" title="Projects">Projects</a></li>
        <li class="active"><a href="../blog.html" title="Blog">Blog</a></li>
      </ul>
    </div>

    <script src="../themes/yago/build/js/vendors.min.js"></script>
    <script src="../themes/yago/build/js/main.js"></script>

    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-41124823-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>

    <script type="text/javascript">
      var FHChat = {product_id: "e62b17d38605"};
      FHChat.properties={};FHChat.set=function(key,data){this.properties[key]=data};FHChat.customAttributes=[];FHChat.sendCustomAttributes=function(data){this.customAttributes.push(data)};!function(){var a,b;return b=document.createElement("script"),a=document.getElementsByTagName("script")[0],b.src="https://chat-client-js.firehoseapp.com/chat-min.js",b.async=!0,a.parentNode.insertBefore(b,a)}();

      var fchatChecker = setInterval(function(){
        var $fchat = $('#fchat');
        if($('#fchat').length > 0){
          setTimeout(function(){
            $('#fchat-header-label').html('Envie de discuter ?');
            $('#fchat-message').attr('placeholder', 'Ton message');
            $('#welcome-message').html('Pour taper un petit brin de causette. À utiliser sans modération !');
          }, 500);
          clearInterval(fchatChecker);
        }
      }, 100);
    </script>

    <script type="text/javascript">
      (function($){
        $(document).ready(function(){
          emojify.setConfig({
              img_dir          : '/themes/yago/build/img/emoji',
              ignore_emoticons : true
          });
          emojify.run();
        });
      }(jQuery));
    </script>
      </body>
</html>
